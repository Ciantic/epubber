import{t as E,d as k,c as v,i as S,a as x,b as I,S as C,B as H,Z as U,e as B,T,r as D}from"./vendor.f9497a2c.js";const z=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}};z();const W=E('<div><h1>Concats all the epub HTML files</h1><h2>Select epub file</h2><input type="file" name=""><h2>Or type fetchable URL</h2><input type="text" placeholder="URL"> <button type="button">Fetch</button><br></div>'),j=E('<div><h1 class="book-title"></h1></div>'),_=E("<div></div>"),Z=E('<section class="html-page"></section>');function p(o,u){return new URL(o,new URL(u,"https://example.com")).pathname}async function G(o){return await o.getData?.(new T)}async function O(o){return await o?.getData?.(new H)}const P=async o=>{const s=await new U(new B(o)).getEntries(),c=new Map(s.map(r=>["/"+r.filename,r])),i=s.filter(r=>r.filename.endsWith(".opf"));if(i.length!==1)throw new Error("OPF confusion");const l=i[0],m=await l.getData?.(new T),g=new DOMParser().parseFromString(m,"text/xml"),b=[...g.querySelectorAll("manifest item")],A=[...g.querySelectorAll("title")].map(r=>r.textContent||""),w=b.filter(r=>r.getAttribute("media-type")?.match(/html/)).map(r=>r.getAttribute("href")||"\u2705").map(r=>{const n=c.get(p(r,l.filename));if(n)return n;const t=c.get(p(r,"/OEBPS/"));if(t)return t;const a=c.get(p(r,"/OPS/"));if(a)return a;const e=c.get(p(r,"/"));if(e)return e}).filter(r=>r);if(w.length===0)throw console.error("OPF",m,"OPF Items:",b,"ZIP File entries:",[...c.keys()]),new Error("No HTML Files found from the ebook");return{documents:(await Promise.all(w.map(async r=>({content:await G(r),filename:r.filename})))).map(({content:r,filename:n})=>{let t=new DOMParser().parseFromString(r,"application/xhtml+xml");return t.querySelector("parsererror")&&(t=new DOMParser().parseFromString(r,"text/html")),t.querySelectorAll("[href]").forEach(e=>{e instanceof HTMLElement&&(e.dataset.href=p(e.getAttribute("href")||"",n),e.setAttribute("href","#"))}),t.querySelectorAll("[src]").forEach(e=>{e instanceof HTMLElement&&(e.dataset.src=p(e.getAttribute("src")||"",n),e.removeAttribute("src"))}),[...t.getElementsByTagNameNS("http://www.w3.org/2000/svg","image")].forEach(e=>{if(e instanceof SVGImageElement){const f=e.getAttributeNS("http://www.w3.org/1999/xlink","href");e.dataset.href=p(f||"",n),e.removeAttributeNS("http://www.w3.org/1999/xlink","href")}}),t.querySelectorAll("style, hr, [aria-hidden]").forEach(e=>{e.remove()}),t.querySelectorAll("[style]").forEach(e=>{e.removeAttribute("style")}),t.querySelectorAll("[class]").forEach(e=>{e.removeAttribute("class")}),t.querySelectorAll("section,article,div").forEach(e=>{e.id||e.replaceWith(...e.childNodes)}),t.querySelectorAll("h1 + h1").forEach(e=>{const f=e.previousElementSibling;f instanceof HTMLHeadingElement&&(f.append(t.createElement("br"),t.createTextNode(" ")),f.append(...e.childNodes),e.remove())}),t}),zipFileMap:c,titles:A}};async function q(o,u){if(o.hasAttribute("src"))return;const s=u.get(o.dataset.src||"");if(!s){console.error("Cant find file",o.dataset.src);return}const c=await O(s);o.src=URL.createObjectURL(new File([c],s.filename))}async function R(o,u){if(o.hasAttributeNS("http://www.w3.org/1999/xlink","href"))return;const s=u.get(o.dataset.href||"");if(!s){console.error("Cant find file",o.dataset.href);return}const c=await O(s);o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",URL.createObjectURL(new File([c],s.filename)))}const V=()=>{let o;const[u,s]=v(""),[c,i]=v([]),[l,m]=v([]),[h,g]=v(new Map),b=new IntersectionObserver(n=>{for(const t of n){const a=t.target;!t.isIntersecting||(a instanceof HTMLImageElement&&q(a,h()),a instanceof SVGElement&&[...a.getElementsByTagName("image")].forEach(e=>{R(e,h())}))}});function A(){document.querySelectorAll("img").forEach(n=>{q(n,h())}),[...document.getElementsByTagName("image")].forEach(n=>{R(n,h())})}function w(n){window.addEventListener("beforeprint",()=>{A()}),setTimeout(()=>{n.querySelectorAll("img").forEach(t=>{b.observe(t)}),n.querySelectorAll("svg").forEach(t=>b.observe(t))})}async function F(){if(!o)return;const n=o.files?.[0];if(n){const{documents:t,zipFileMap:a,titles:e}=await P(n);m(t),g(a),i(e)}}async function $(n){try{const t=await fetch(n),{documents:a,zipFileMap:e,titles:f}=await P(await t.blob());m(a),g(e),i(f)}catch(t){t instanceof TypeError?s(t.name+": "+t.message):s("Unable to fetch")}}function r(){return(()=>{const n=W.cloneNode(!0),t=n.firstChild,a=t.nextSibling,e=a.nextSibling,f=e.nextSibling,d=f.nextSibling,y=d.nextSibling,L=y.nextSibling;L.nextSibling,e.$$input=F;const M=o;return typeof M=="function"?M(e):o=e,L.$$click=N=>{N.target.previousElementSibling instanceof HTMLInputElement&&$(N.target.previousElementSibling.value)},S(n,u,null),n})()}return(()=>{const n=_.cloneNode(!0);return S(n,x(C,{get when(){return l().length>0},fallback:()=>x(r,{}),get children(){const t=j.cloneNode(!0),a=t.firstChild,e=w;return typeof e=="function"?e(t):w=t,S(a,()=>c().map((f,d)=>(()=>{const y=_.cloneNode(!0);return y.className=`line${d}`,S(y,f),y})())),S(t,()=>l().map(f=>(()=>{const d=Z.cloneNode(!0);return I(()=>d.innerHTML=f.body.outerHTML),d})()),null),t}})),n})()};k(["input","click"]);D(()=>x(V,{}),document.getElementById("root"));
