import{t as w,d as N,c as E,i as h,a as $,b as O,S as H,B as I,Z as R,e as C,T as x,r as U}from"./vendor.f9497a2c.js";const D=function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}};D();const k=w('<div><h1>Concats all the epub HTML files</h1><h2>Select epub file</h2><input type="file" name=""><h2>Or type fetchable URL</h2><input type="text" placeholder="URL"> <button type="button">Fetch</button><br></div>'),B=w('<div><h1 class="book-title"></h1></div>'),T=w("<div></div>"),z=w('<section class="html-page"></section>');function S(l,f){return new URL(l,new URL(f,"https://example.com")).pathname}const P=async l=>{const s=await new R(new C(l)).getEntries(),a=new Map(s.map(e=>["/"+e.filename,e])),o=s.filter(e=>e.filename.endsWith(".opf"));if(o.length!==1)throw new Error("OPF confusion");const m=await o[0].getData?.(new x),p=new DOMParser().parseFromString(m,"text/xml"),g=[...p.querySelectorAll("manifest item")],b=[...p.querySelectorAll("title")].map(e=>e.textContent||""),y=g.filter(e=>e.getAttribute("media-type")?.match(/html/)).map(e=>e.getAttribute("href")||"\u2705").map(e=>{const n=a.get(S(e,"/OEBPS/"));if(n)return n;const r=a.get(S(e,"/"));if(r)return r}).filter(e=>e);if(y.length===0)throw console.error("OPF Items:",g,"ZIP File entries:",s.keys()),new Error("No HTML Files found from the ebook");return{documents:(await Promise.all(y.map(async e=>({content:await e.getData?.(new x),filename:e.filename})))).map(({content:e,filename:n})=>{let r=new DOMParser().parseFromString(e,"application/xhtml+xml");return r.querySelector("parsererror")&&(r=new DOMParser().parseFromString(e,"text/html")),r.querySelectorAll("[href]").forEach(t=>{t instanceof HTMLElement&&(t.dataset.href=S(t.getAttribute("href")||"",n),t.setAttribute("href","#"))}),r.querySelectorAll("[src]").forEach(t=>{t instanceof HTMLElement&&(t.dataset.src=S(t.getAttribute("src")||"",n),t.removeAttribute("src"))}),r.querySelectorAll("style, hr, [aria-hidden]").forEach(t=>{t.remove()}),r.querySelectorAll("[style]").forEach(t=>{t.removeAttribute("style")}),r.querySelectorAll("[class]").forEach(t=>{t.removeAttribute("class")}),r.querySelectorAll("section,article,div").forEach(t=>{t.id||t.replaceWith(...t.childNodes)}),r.querySelectorAll("h1 + h1").forEach(t=>{const u=t.previousElementSibling;u instanceof HTMLHeadingElement&&(u.append(r.createElement("br"),r.createTextNode(" ")),u.append(...t.childNodes),t.remove())}),r}),zipFileMap:a,titles:b}};async function q(l,f){if(l.hasAttribute("src"))return;const s=f.get(l.dataset.src||"");if(s){const a=await s.getData?.(new I);a instanceof Blob&&(l.src=URL.createObjectURL(new File([a],s.filename)))}}const W=()=>{let l;const[f,s]=E(""),[a,o]=E([]),[i,m]=E([]),[v,p]=E(new Map),g=new IntersectionObserver(e=>{for(const n of e)if(n.target instanceof HTMLImageElement){const r=n.target;n.isIntersecting&&q(r,v())}});window.addEventListener("beforeprint",()=>{document.querySelectorAll("img").forEach(e=>{q(e,v())})});function b(e){setTimeout(()=>{e.querySelectorAll("img").forEach(n=>{g.observe(n)})})}async function y(){if(!l)return;const e=l.files?.[0];if(e){const{documents:n,zipFileMap:r,titles:c}=await P(e);m(n),p(r),o(c)}}async function A(e){try{const n=await fetch(e),{documents:r,zipFileMap:c,titles:t}=await P(await n.blob());m(r),p(c),o(t)}catch(n){n instanceof TypeError?s(n.name+": "+n.message):s("Unable to fetch")}}function F(){return(()=>{const e=k.cloneNode(!0),n=e.firstChild,r=n.nextSibling,c=r.nextSibling,t=c.nextSibling,u=t.nextSibling,d=u.nextSibling,L=d.nextSibling;L.nextSibling,c.$$input=y;const M=l;return typeof M=="function"?M(c):l=c,L.$$click=_=>{_.target.previousElementSibling instanceof HTMLInputElement&&A(_.target.previousElementSibling.value)},h(e,f,null),e})()}return(()=>{const e=T.cloneNode(!0);return h(e,$(H,{get when(){return i().length>0},fallback:()=>$(F,{}),get children(){const n=B.cloneNode(!0),r=n.firstChild,c=b;return typeof c=="function"?c(n):b=n,h(r,()=>a().map((t,u)=>(()=>{const d=T.cloneNode(!0);return d.className=`line${u}`,h(d,t),d})())),h(n,()=>i().map(t=>(()=>{const u=z.cloneNode(!0);return O(()=>u.innerHTML=t.body.outerHTML),u})()),null),n}})),e})()};N(["input","click"]);U(()=>$(W,{}),document.getElementById("root"));
