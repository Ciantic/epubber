import{t as b,d as P,c as y,B as O,i as w,a as S,b as T,S as R,Z as q,e as H,T as v,r as I}from"./vendor.f9497a2c.js";const N=function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function c(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=c(n);fetch(n.href,l)}};N();const U=b('<div><h1>Concats all the epub HTML files</h1><h2>Select epub file</h2><input type="file" name=""><h2>Or type fetchable URL</h2><input type="text" placeholder="URL"> <button type="button">Fetch</button><br></div>'),x=b("<div></div>"),D=b('<section class="page"></section>');function h(s,f){return new URL(s,new URL(f,"https://example.com")).pathname}const A=async s=>{const c=await new q(new H(s)).getEntries(),a=new Map(c.map(e=>["/"+e.filename,e])),n=c.filter(e=>e.filename.endsWith(".opf"));if(n.length!==1)throw new Error("OPF confusion");const u=await n[0].getData?.(new v),p=[...new DOMParser().parseFromString(u,"text/xml").querySelectorAll("manifest item")],d=p.filter(e=>e.getAttribute("media-type")?.match(/html/)).map(e=>e.getAttribute("href")||"\u2705").map(e=>{const r=a.get(h(e,"/OEBPS/"));if(r)return r;const t=a.get(h(e,"/"));if(t)return t}).filter(e=>e);if(d.length===0)throw console.error("OPF Items:",p,"ZIP File entries:",c.keys()),new Error("No HTML Files found from the ebook");return{documents:(await Promise.all(d.map(async e=>({content:await e.getData?.(new v),filename:e.filename})))).map(({content:e,filename:r})=>{let t=new DOMParser().parseFromString(e,"application/xhtml+xml");return t.querySelector("parsererror")&&(t=new DOMParser().parseFromString(e,"text/html")),t.querySelectorAll("[href]").forEach(i=>{i instanceof HTMLElement&&(i.dataset.href=h(i.getAttribute("href")||"",r),i.setAttribute("href","#"))}),t.querySelectorAll("[src]").forEach(i=>{i instanceof HTMLElement&&(i.dataset.src=h(i.getAttribute("src")||"",r),i.removeAttribute("src"))}),t.querySelectorAll("style").forEach(i=>{i.remove()}),t.querySelectorAll("[style]").forEach(i=>{i.removeAttribute("style")}),t}),zipFileMap:a}},B=()=>{let s;const[f,c]=y(""),[a,n]=y([]),[l,u]=y(new Map),E=new IntersectionObserver(o=>{for(const e of o)if(e.target instanceof HTMLImageElement){const r=e.target;if(e.isIntersecting&&!r.hasAttribute("src")){const t=l().get(r.dataset.src||"");t&&(async()=>{const m=await t.getData?.(new O);m instanceof Blob&&(r.src=URL.createObjectURL(new File([m],t.filename)))})()}}});function g(o){setTimeout(()=>{o.querySelectorAll("img").forEach(e=>{E.observe(e)})})}async function p(){if(!s)return;const o=s.files?.[0];if(o){const{documents:e,zipFileMap:r}=await A(o);n(e),u(r)}}async function d(o){try{const e=await fetch(o),{documents:r,zipFileMap:t}=await A(await e.blob());n(r),u(t)}catch(e){e instanceof TypeError?c(e.name+": "+e.message):c("Unable to fetch")}}function F(){return(()=>{const o=U.cloneNode(!0),e=o.firstChild,r=e.nextSibling,t=r.nextSibling,m=t.nextSibling,i=m.nextSibling,_=i.nextSibling,M=_.nextSibling;M.nextSibling,t.$$input=p;const $=s;return typeof $=="function"?$(t):s=t,M.$$click=L=>{L.target.previousElementSibling instanceof HTMLInputElement&&d(L.target.previousElementSibling.value)},w(o,f,null),o})()}return(()=>{const o=x.cloneNode(!0);return w(o,S(R,{get when(){return a().length>0},fallback:()=>S(F,{}),get children(){const e=x.cloneNode(!0),r=g;return typeof r=="function"?r(e):g=e,w(e,()=>a().map(t=>(()=>{const m=D.cloneNode(!0);return T(()=>m.innerHTML=t.body.outerHTML),m})())),e}})),o})()};P(["input","click"]);I(()=>S(B,{}),document.getElementById("root"));
