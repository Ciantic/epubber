import{t as S,d as k,c as v,i as E,a as x,b as I,S as C,B as H,Z as U,e as B,T,r as D}from"./vendor.f9497a2c.js";const z=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))f(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&f(m)}).observe(document,{childList:!0,subtree:!0});function a(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function f(i){if(i.ep)return;i.ep=!0;const l=a(i);fetch(i.href,l)}};z();const W=S('<div><h1>Concats all the epub HTML files</h1><h2>Select epub file</h2><input type="file" name=""><h2>Or type fetchable URL</h2><input type="text" placeholder="URL"> <button type="button">Fetch</button><br></div>'),j=S('<div><h1 class="book-title"></h1></div>'),_=S("<div></div>"),Z=S('<section class="html-page"></section>');function d(o,u){return new URL(o,new URL(u,"https://example.com")).pathname}async function G(o){return await o.getData?.(new T)}async function O(o){return await o?.getData?.(new H)}const P=async o=>{const a=await new U(new B(o)).getEntries(),f=new Map(a.map(r=>["/"+r.filename,r])),i=a.filter(r=>r.filename.endsWith(".opf"));if(i.length!==1)throw new Error("OPF confusion");const l=i[0],m=await l.getData?.(new T),g=new DOMParser().parseFromString(m,"text/xml"),b=[...g.querySelectorAll("manifest item")],A=[...g.querySelectorAll("title")].map(r=>r.textContent||""),w=b.filter(r=>r.getAttribute("media-type")?.match(/html/)).map(r=>r.getAttribute("href")||"\u2705").map(r=>{const n=f.get(d(r,l.filename));if(n)return n;const t=f.get(d(r,"/OEBPS/"));if(t)return t;const c=f.get(d(r,"/OPS/"));if(c)return c;const e=f.get(d(r,"/"));if(e)return e}).filter(r=>r);if(w.length===0)throw console.error("OPF",m,"OPF Items:",b,"ZIP File entries:",[...f.keys()]),new Error("No HTML Files found from the ebook");return{documents:(await Promise.all(w.map(async r=>({content:await G(r),filename:r.filename})))).map(({content:r,filename:n})=>{let t=new DOMParser().parseFromString(r,"application/xhtml+xml");return t.querySelector("parsererror")&&(t=new DOMParser().parseFromString(r,"text/html")),t.querySelectorAll("[href]").forEach(e=>{e instanceof HTMLElement&&(e.dataset.href=d(e.getAttribute("href")||"",n),e.setAttribute("href","#"))}),t.querySelectorAll("[src]").forEach(e=>{e instanceof HTMLElement&&(e.dataset.src=d(e.getAttribute("src")||"",n),e.removeAttribute("src"))}),[...t.getElementsByTagNameNS("http://www.w3.org/2000/svg","image")].forEach(e=>{if(e instanceof SVGImageElement){const s=e.getAttributeNS("http://www.w3.org/1999/xlink","href");e.dataset.href=d(s||"",n),e.removeAttributeNS("http://www.w3.org/1999/xlink","href")}}),t.querySelectorAll("style, hr, [aria-hidden]").forEach(e=>{e.remove()}),t.querySelectorAll("[style]").forEach(e=>{e.removeAttribute("style")}),t.querySelectorAll("[class]").forEach(e=>{e.removeAttribute("class")}),t.querySelectorAll("section,article,div").forEach(e=>{if(!e.id)e.replaceWith(...e.childNodes);else{const s=t.createElement("div");s.id=e.id,s.append(...e.childNodes),e.replaceWith(s)}}),t.querySelectorAll("h1 + h1").forEach(e=>{const s=e.previousElementSibling;s instanceof HTMLHeadingElement&&(s.append(t.createElement("br"),t.createTextNode(" ")),s.append(...e.childNodes),e.remove())}),t}),zipFileMap:f,titles:A}};async function q(o,u){if(o.hasAttribute("src"))return;const a=u.get(o.dataset.src||"");if(!a){console.error("Cant find file",o.dataset.src);return}const f=await O(a);o.src=URL.createObjectURL(new File([f],a.filename))}async function R(o,u){if(o.hasAttributeNS("http://www.w3.org/1999/xlink","href"))return;const a=u.get(o.dataset.href||"");if(!a){console.error("Cant find file",o.dataset.href);return}const f=await O(a);o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",URL.createObjectURL(new File([f],a.filename)))}const V=()=>{let o;const[u,a]=v(""),[f,i]=v([]),[l,m]=v([]),[h,g]=v(new Map),b=new IntersectionObserver(n=>{for(const t of n){const c=t.target;!t.isIntersecting||(c instanceof HTMLImageElement&&q(c,h()),c instanceof SVGElement&&[...c.getElementsByTagName("image")].forEach(e=>{R(e,h())}))}});function A(){document.querySelectorAll("img").forEach(n=>{q(n,h())}),[...document.getElementsByTagName("image")].forEach(n=>{R(n,h())})}function w(n){window.addEventListener("beforeprint",()=>{A()}),setTimeout(()=>{n.querySelectorAll("img").forEach(t=>{b.observe(t)}),n.querySelectorAll("svg").forEach(t=>b.observe(t))})}async function F(){if(!o)return;const n=o.files?.[0];if(n){const{documents:t,zipFileMap:c,titles:e}=await P(n);m(t),g(c),i(e)}}async function $(n){try{const t=await fetch(n),{documents:c,zipFileMap:e,titles:s}=await P(await t.blob());m(c),g(e),i(s)}catch(t){t instanceof TypeError?a(t.name+": "+t.message):a("Unable to fetch")}}function r(){return(()=>{const n=W.cloneNode(!0),t=n.firstChild,c=t.nextSibling,e=c.nextSibling,s=e.nextSibling,p=s.nextSibling,y=p.nextSibling,L=y.nextSibling;L.nextSibling,e.$$input=F;const N=o;return typeof N=="function"?N(e):o=e,L.$$click=M=>{M.target.previousElementSibling instanceof HTMLInputElement&&$(M.target.previousElementSibling.value)},E(n,u,null),n})()}return(()=>{const n=_.cloneNode(!0);return E(n,x(C,{get when(){return l().length>0},fallback:()=>x(r,{}),get children(){const t=j.cloneNode(!0),c=t.firstChild,e=w;return typeof e=="function"?e(t):w=t,E(c,()=>f().map((s,p)=>(()=>{const y=_.cloneNode(!0);return y.className=`line${p}`,E(y,s),y})())),E(t,()=>l().map(s=>(()=>{const p=Z.cloneNode(!0);return I(()=>p.innerHTML=s.body.outerHTML),p})()),null),t}})),n})()};k(["input","click"]);D(()=>x(V,{}),document.getElementById("root"));
