import{t as b,d as A,c as y,B as O,i as w,a as S,b as T,S as R,Z as H,e as I,T as v,r as N}from"./vendor.f9497a2c.js";const U=function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function c(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(t){if(t.ep)return;t.ep=!0;const i=c(t);fetch(t.href,i)}};U();const D=b('<div><h1>Concats all the epub HTML files</h1><h2>Select epub file</h2><input type="file" name=""><h2>Or type fetchable URL</h2><input type="text" placeholder="URL"> <button type="button">Fetch</button><br></div>'),x=b("<div></div>"),q=b('<section class="page"></section>');function h(l,f){return new URL(l,new URL(f,"https://example.com")).pathname}const _=async l=>{const c=await new H(new I(l)).getEntries(),a=new Map(c.map(e=>["/"+e.filename,e])),t=c.filter(e=>e.filename.endsWith(".opf"));if(t.length!==1)throw new Error("OPF confusion");const u=await t[0].getData?.(new v),m=[...new DOMParser().parseFromString(u,"text/xml").querySelectorAll("manifest item")],d=m.filter(e=>e.getAttribute("media-type")?.match(/html/)).map(e=>e.getAttribute("href")||"\u2705").map(e=>{const r=a.get(h(e,"/OEBPS/"));if(r)return r;const n=a.get(h(e,"/"));if(n)return n}).filter(e=>e);if(d.length===0)throw console.error("OPF Items:",m,"ZIP File entries:",c.keys()),new Error("No HTML Files found from the ebook");return{documents:(await Promise.all(d.map(async e=>({content:await e.getData?.(new v),filename:e.filename})))).map(({content:e,filename:r})=>{let n=new DOMParser().parseFromString(e,"application/xhtml+xml");return n.querySelector("parsererror")&&(n=new DOMParser().parseFromString(e,"text/html")),n.querySelectorAll("[href]").forEach(s=>{s instanceof HTMLElement&&(s.dataset.href=h(s.getAttribute("href")||"",r),s.setAttribute("href","#"))}),n.querySelectorAll("[src]").forEach(s=>{s instanceof HTMLElement&&(s.dataset.src=h(s.getAttribute("src")||"",r),s.removeAttribute("src"))}),n}),zipFileMap:a}},B=()=>{let l;const[f,c]=y(""),[a,t]=y([]),[i,u]=y(new Map),E=new IntersectionObserver(o=>{for(const e of o)if(e.target instanceof HTMLImageElement){const r=e.target;if(e.isIntersecting&&!r.hasAttribute("src")){const n=i().get(r.dataset.src||"");n&&(async()=>{const p=await n.getData?.(new O);p instanceof Blob&&(r.src=URL.createObjectURL(new File([p],n.filename)))})()}}});function g(o){setTimeout(()=>{o.querySelectorAll("img").forEach(e=>{E.observe(e)})})}async function m(){if(!l)return;const o=l.files?.[0];if(o){const{documents:e,zipFileMap:r}=await _(o);t(e),u(r)}}async function d(o){try{const e=await fetch(o),{documents:r,zipFileMap:n}=await _(await e.blob());t(r),u(n)}catch(e){e instanceof TypeError?c(e.name+": "+e.message):c("Unable to fetch")}}function F(){return(()=>{const o=D.cloneNode(!0),e=o.firstChild,r=e.nextSibling,n=r.nextSibling,p=n.nextSibling,s=p.nextSibling,P=s.nextSibling,M=P.nextSibling;M.nextSibling,n.$$input=m;const $=l;return typeof $=="function"?$(n):l=n,M.$$click=L=>{L.target.previousElementSibling instanceof HTMLInputElement&&d(L.target.previousElementSibling.value)},w(o,f,null),o})()}return(()=>{const o=x.cloneNode(!0);return w(o,S(R,{get when(){return a().length>0},fallback:()=>S(F,{}),get children(){const e=x.cloneNode(!0),r=g;return typeof r=="function"?r(e):g=e,w(e,()=>a().map(n=>(()=>{const p=q.cloneNode(!0);return T(()=>p.innerHTML=n.body.outerHTML),p})())),e}})),o})()};A(["input","click"]);N(()=>S(B,{}),document.getElementById("root"));
